<div class="realtime-dashboard">
  <!-- Header -->
  <mat-card class="header-card">
    <mat-card-header>
      <mat-icon mat-card-avatar>live_tv</mat-icon>
      <mat-card-title>Real-time Attendance Dashboard</mat-card-title>
      <mat-card-subtitle>
        <span class="connection-status" [class.connected]="isConnected">
          <mat-icon>{{ isConnected ? 'wifi' : 'wifi_off' }}</mat-icon>
          {{ isConnected ? 'Connected' : 'Disconnected' }}
        </span>
      </mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <!-- Class Selection -->
  <mat-card class="selection-card">
    <mat-card-content>
      <div class="selection-row">
        <mat-form-field appearance="outline">
          <mat-label>Program</mat-label>
          <mat-select [(ngModel)]="selectedProgram" (selectionChange)="onClassSelectionChange()">
            <mat-option *ngFor="let program of programs" [value]="program">
              {{ program }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Year</mat-label>
          <mat-select [(ngModel)]="selectedYear" (selectionChange)="onClassSelectionChange()">
            <mat-option *ngFor="let year of years" [value]="year">
              Year {{ year }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="onClassSelectionChange()" 
                [disabled]="!selectedProgram || !selectedYear">
          <mat-icon>refresh</mat-icon>
          Load Class
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Current Session Info -->
  <mat-card class="session-card" *ngIf="currentSession">
    <mat-card-content>
      <div class="session-info">
        <div class="session-item">
          <mat-icon>book</mat-icon>
          <div>
            <div class="label">Subject</div>
            <div class="value">{{ currentSession.subject }}</div>
          </div>
        </div>
        
        <div class="session-item">
          <mat-icon>meeting_room</mat-icon>
          <div>
            <div class="label">Hall</div>
            <div class="value">{{ currentSession.hallName }}</div>
          </div>
        </div>
        
        <div class="session-item">
          <mat-icon>schedule</mat-icon>
          <div>
            <div class="label">Period {{ currentSession.periodNumber }}</div>
            <div class="value">{{ currentSession.startTime }} - {{ currentSession.endTime }}</div>
          </div>
        </div>
        
        <div class="session-item">
          <mat-icon>person</mat-icon>
          <div>
            <div class="label">Faculty</div>
            <div class="value">{{ currentSession.faculty }}</div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- No Session Warning -->
  <mat-card class="warning-card" *ngIf="selectedProgram && selectedYear && !currentSession">
    <mat-card-content>
      <mat-icon>info</mat-icon>
      <p>No active session found for this class at the moment.</p>
    </mat-card-content>
  </mat-card>

  <!-- Statistics Cards -->
  <div class="stats-grid" *ngIf="studentStatuses.data.length > 0">
    <mat-card class="stat-card total">
      <mat-card-content>
        <mat-icon>groups</mat-icon>
        <div class="stat-value">{{ classStats.total }}</div>
        <div class="stat-label">Total Students</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card present">
      <mat-card-content>
        <mat-icon>check_circle</mat-icon>
        <div class="stat-value">{{ classStats.present }}</div>
        <div class="stat-label">Present (In)</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card out">
      <mat-card-content>
        <mat-icon>logout</mat-icon>
        <div class="stat-value">{{ classStats.out }}</div>
        <div class="stat-label">Out</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card absent">
      <mat-card-content>
        <mat-icon>cancel</mat-icon>
        <div class="stat-value">{{ classStats.absent }}</div>
        <div class="stat-label">Absent</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card pending">
      <mat-card-content>
        <mat-icon>schedule</mat-icon>
        <div class="stat-value">{{ classStats.pending }}</div>
        <div class="stat-label">Pending</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card on-leave">
      <mat-card-content>
        <mat-icon>event_busy</mat-icon>
        <div class="stat-value">{{ classStats.onLeave }}</div>
        <div class="stat-label">On Leave</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Students List -->
  <mat-card class="students-card" *ngIf="studentStatuses.data.length > 0">
    <mat-card-header>
      <mat-card-title>Students Status</mat-card-title>
      <mat-card-subtitle>Real-time attendance tracking</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="studentStatuses" class="students-table">
        <!-- Roll Number Column -->
        <ng-container matColumnDef="rollNumber">
          <th mat-header-cell *matHeaderCellDef>Roll Number</th>
          <td mat-cell *matCellDef="let student">{{ student.rollNumber }}</td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Student Name</th>
          <td mat-cell *matCellDef="let student">
            <strong>{{ student.name }}</strong>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let student">
            <mat-chip [class.mat-chip-selected]="student.status !== 'Pending'">
              <mat-icon>{{ getStatusIcon(student.status) }}</mat-icon>
              <span [style.color]="getStatusTextColor(student.status)">{{ student.status }}</span>
            </mat-chip>
            <div *ngIf="student.onLeave && student.leaveReason" class="leave-tooltip">
              <small>{{ student.leaveReason }}</small>
            </div>
          </td>
        </ng-container>

        <!-- Last Updated Column -->
        <ng-container matColumnDef="lastUpdated">
          <th mat-header-cell *matHeaderCellDef>Last Updated</th>
          <td mat-cell *matCellDef="let student">
            <div *ngIf="student.lastUpdated">
              {{ formatTimestamp(student.lastUpdated) }}
              <small *ngIf="student.hallName">@ {{ student.hallName }}</small>
            </div>
            <div *ngIf="!student.lastUpdated">-</div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="studentColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: studentColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>

  <!-- Empty State -->
  <mat-card class="empty-state" *ngIf="studentStatuses.data.length === 0">
    <mat-card-content>
      <mat-icon>school</mat-icon>
      <h3>Select a Class to View Attendance</h3>
      <p>Choose a program and year from the dropdowns above to start tracking attendance.</p>
    </mat-card-content>
  </mat-card>
</div>
