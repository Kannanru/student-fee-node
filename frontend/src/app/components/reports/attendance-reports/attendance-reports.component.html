<div class="attendance-reports">
  <h2>Attendance Reports</h2>

  <mat-card class="filters">
    <div class="filters-grid">
      <mat-form-field appearance="outline">
        <mat-label>Start date</mat-label>
        <input matInput [matDatepicker]="dp1" [(ngModel)]="startDate">
        <mat-datepicker-toggle matSuffix [for]="dp1"></mat-datepicker-toggle>
        <mat-datepicker #dp1></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>End date</mat-label>
        <input matInput [matDatepicker]="dp2" [(ngModel)]="endDate">
        <mat-datepicker-toggle matSuffix [for]="dp2"></mat-datepicker-toggle>
        <mat-datepicker #dp2></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Class</mat-label>
        <input matInput placeholder="e.g., BSc Nursing 1st Year" [(ngModel)]="className">
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Section</mat-label>
        <input matInput placeholder="A/B/C" [(ngModel)]="section">
      </mat-form-field>
      <div class="filter-actions">
        <button mat-raised-button color="primary" (click)="load()"><mat-icon>search</mat-icon> Apply</button>
        <button mat-stroked-button (click)="reset()"><mat-icon>backspace</mat-icon> Reset</button>
        <button mat-stroked-button (click)="exportCsv()"><mat-icon>download</mat-icon> Export CSV</button>
      </div>
    </div>
  </mat-card>

  <div class="loading" *ngIf="loading()"><mat-spinner diameter="40"></mat-spinner></div>

  <div *ngIf="!loading()">
    <mat-card class="summary" *ngIf="summary() as s">
      <div class="summary-grid">
        <div>
          <div class="label">Avg Attendance</div>
          <div class="value">{{ (s.average || 0) | number:'1.0-2' }}%</div>
        </div>
        <div>
          <div class="label">Days</div>
          <div class="value">{{ s.days || 0 }}</div>
        </div>
        <div>
          <div class="label">Absences</div>
          <div class="value">{{ s.absences || 0 }}</div>
        </div>
      </div>
    </mat-card>

    <mat-card class="table-card">
      <mat-card-title>Daily Summary</mat-card-title>
      <table mat-table [dataSource]="rows()">
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Date</th>
          <td mat-cell *matCellDef="let r">{{ r.date | date:'mediumDate' }}</td>
        </ng-container>
        <ng-container matColumnDef="present">
          <th mat-header-cell *matHeaderCellDef>Present</th>
          <td mat-cell *matCellDef="let r">{{ r.present }}</td>
        </ng-container>
        <ng-container matColumnDef="absent">
          <th mat-header-cell *matHeaderCellDef>Absent</th>
          <td mat-cell *matCellDef="let r">{{ r.absent }}</td>
        </ng-container>
        <ng-container matColumnDef="percentage">
          <th mat-header-cell *matHeaderCellDef>%</th>
          <td mat-cell *matCellDef="let r">{{ r.percentage | number:'1.0-2' }}%</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayed"></tr>
        <tr mat-row *matRowDef="let row; columns: displayed"></tr>
      </table>
    </mat-card>
  </div>
</div>
