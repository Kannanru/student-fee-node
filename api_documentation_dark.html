<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MGDC API Documentation</title>
  <style>
    :root{
      --bg:#0b0c10; --panel:#111317; --muted:#9aa0a6; --text:#e5e7eb; --accent:#60a5fa; --border:#1f232a; --good:#10b981; --warn:#f59e0b; --bad:#ef4444;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{ box-sizing: border-box; }
    body{ margin:0; background:var(--bg); color:var(--text); font-family: var(--sans); }
    header{ position: sticky; top:0; z-index:5; backdrop-filter: blur(6px); background: rgba(11,12,16,0.7); border-bottom:1px solid var(--border); }
    header .wrap{ max-width:1200px; margin:0 auto; padding:14px 18px; display:flex; align-items:center; justify-content:space-between; }
    header h1{ font-size:18px; margin:0; }
    header .env{ font-size:12px; color:var(--muted); }
    .layout{ display:grid; grid-template-columns: 280px 1fr; gap:0; max-width:1200px; margin:0 auto; }
    nav{ border-right:1px solid var(--border); background:var(--panel); min-height: calc(100vh - 56px); padding:14px; position: sticky; top:56px; }
    nav h3{ margin:8px 10px; font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing: .06em; }
    nav a{ display:block; color:var(--text); text-decoration:none; padding:8px 10px; border-radius:8px; font-size:14px; }
    nav a:hover{ background:#1a1d24; color:#dbeafe; }
    main{ padding:20px; }
    section{ padding:18px; background:var(--panel); border:1px solid var(--border); border-radius:12px; margin-bottom:16px; }
    section h2{ margin:0 0 8px; font-size:18px; }
    section h3{ margin:12px 0 8px; font-size:15px; color:#cbd5e1; }
    p, li{ color:#d1d5db; }
    code, pre{ font-family: var(--mono); font-size:12px; background:#0c0f14; color:#e5e7eb; border:1px solid #111827; border-radius:8px; }
    pre{ padding:12px; overflow:auto; }
    .kbd{ font-family: var(--mono); font-size:12px; padding:2px 6px; border-radius:6px; background:#0c0f14; border:1px solid #111827; color:#cbd5e1; }
    .pill{ display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid var(--border); font-size:12px; color:#cbd5e1; }
    .get{ color:#34d399; } .post{ color:#60a5fa; } .put{ color:#f59e0b; } .del{ color:#f87171; }
    table{ width:100%; border-collapse: collapse; border:1px solid var(--border); border-radius:10px; overflow:hidden; }
    th, td{ border-bottom:1px solid var(--border); padding:8px 10px; text-align:left; font-size:13px; }
    th{ background:#161a22; color:#cbd5e1; font-weight:600; }
    .endpoint{ display:flex; gap:8px; align-items:center; }
    .method{ font-weight:700; width:64px; text-align:center; }
    .note{ color:var(--muted); font-size:12px; }
  </style>
  <script>
    function to(id){ document.getElementById(id)?.scrollIntoView({behavior:'smooth', block:'start'}); }
  </script>
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#0b0c10" />
  </head>
<body>
  <header>
    <div class="wrap">
      <h1>MGDC API Documentation</h1>
      <div class="env">Base URL: <span class="kbd">http://localhost:5000</span></div>
    </div>
  </header>
  <div class="layout">
    <nav>
      <h3>Contents</h3>
      <a href="#" onclick="to('overview');return false;">Overview & Auth</a>
      <a href="#" onclick="to('flow');return false;">Functional Flow</a>
      <a href="#" onclick="to('students');return false;">Students</a>
  <a href="#" onclick="to('employees');return false;">Employees</a>
      <a href="#" onclick="to('fees');return false;">Fees & Payments</a>
      <a href="#" onclick="to('attendance');return false;">Attendance</a>
      <a href="#" onclick="to('timetable');return false;">Timetable</a>
      <a href="#" onclick="to('reports');return false;">Exports & Reports</a>
      <a href="#" onclick="to('dashboard');return false;">Admin Dashboard</a>
      <a href="#" onclick="to('env');return false;">Environment Notes</a>
    </nav>
    <main>
      <section id="overview">
        <h2>Overview & Authentication</h2>
        <p>All protected endpoints require <span class="kbd">Authorization: Bearer &lt;JWT&gt;</span>. Obtain a token using Student or Employee login (as implemented in your backend).</p>
        <div class="endpoint"><span class="pill">POST</span><span class="method post">POST</span><code>/api/students/login</code></div>
    <pre>{
  "email": "student@example.com",
  "password": "Password123"
}</pre>
    <h3>Response</h3>
    <pre>{
  "success": true,
  "message": "Login successful",
  "token": "<JWT>",
  "student": { "_id": "...", "studentId": "STU001", "firstName": "Jane", "lastName": "Smith", "programName": "MBBS" }
}</pre>
    <h3>curl</h3>
    <pre>curl -X POST http://localhost:5000/api/students/login \
  -H "Content-Type: application/json" \
  -d '{"email":"student@example.com","password":"Password123"}'</pre>
    <p class="note">Store the token and send it as <span class="kbd">Authorization: Bearer &lt;token&gt;</span> for subsequent requests.</p>
      </section>

      <section id="flow">
        <h2>Functional Flow</h2>
        <ol>
          <li><strong>Login</strong>: Student/Employee logs in and receives JWT.</li>
          <li><strong>Master Setup</strong>: Admin creates PenaltyConfig and Fee Structure for a student/academic year.</li>
          <li><strong>Mobile Fees View</strong>: Student fetches fee details for payment UI.</li>
          <li><strong>Payment</strong>: Create Razorpay Order, complete payment on client, then verify signature server-side; Fee is updated.</li>
          <li><strong>Timetable</strong>: Admin defines class schedules; API can link attendance with timetable.</li>
          <li><strong>Attendance</strong>: System records AI/admin attendance; alerts via SSE; admin/student views.</li>
          <li><strong>Reports</strong>: Admin uses dashboard, occupancy, CSV and PDF exports.</li>
        </ol>
      </section>

      <section id="students">
        <h2>Students</h2>
        <table>
          <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
          <tr><td class="get">GET</td><td><code>/api/students?programName=...&page=...&limit=...</code></td><td>List + filter students</td></tr>
          <tr><td class="post">POST</td><td><code>/api/students</code></td><td>Create student profile</td></tr>
          <tr><td class="post">POST</td><td><code>/api/students/login</code></td><td>Student login (returns token + profile)</td></tr>
          <tr><td class="get">GET</td><td><code>/api/students/:id</code></td><td>Get student by ID</td></tr>
          <tr><td class="put">PUT</td><td><code>/api/students/:id</code></td><td>Update student (rehashes password if changed)</td></tr>
        </table>
      </section>

      <section id="employees">
        <h2>Employees</h2>
        <table>
          <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
          <tr><td class="get">GET</td><td><code>/api/employees?q=&role=&status=&page=&limit=</code></td><td>List employees (search & filters)</td></tr>
          <tr><td class="post">POST</td><td><code>/api/employees</code></td><td>Create employee</td></tr>
          <tr><td class="get">GET</td><td><code>/api/employees/:id</code></td><td>Get employee</td></tr>
          <tr><td class="put">PUT</td><td><code>/api/employees/:id</code></td><td>Update employee</td></tr>
        </table>
      </section>

      <section id="fees">
        <h2>Fees & Payments</h2>
        <h3>Penalty & Fee Structure</h3>
        <table>
          <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
          <tr><td class="post">POST</td><td><code>/api/penalty-config</code></td><td>Create penalty configuration (per academic year)</td></tr>
          <tr><td class="get">GET</td><td><code>/api/penalty-config</code></td><td>List penalty configurations</td></tr>
          <tr><td class="post">POST</td><td><code>/api/fees/structure</code></td><td>Create fee structure for a student</td></tr>
          <tr><td class="get">GET</td><td><code>/api/fees/student/:studentId</code></td><td>Get fee details for mobile UI</td></tr>
        </table>
        <h4>Create Fee Structure (request)</h4>
        <pre>{
  "studentId": "<studentObjectId>",
  "academicYear": "2025-2026",
  "semester": "1",
  "feeBreakdown": {"tuitionFee": 100000, "semesterFee": 25000},
  "dueDate": "2025-10-31"
}</pre>
        <h4>Get Student Fee Details (response)</h4>
        <pre>{
  "success": true,
  "data": [
    {
      "studentInfo": {"studentName": "Jane Smith", "studentId": "STU001234", "courseGroup": "MBBS", "yearBatch": "2025-2026"},
      "feeDueSection": {"currentDueAmount": 155000, "penaltyAmount": 5000, "dueDate": "2025-10-31T00:00:00.000Z", "status": "Overdue"},
      "paymentHistory": [ {"paymentDate": "2025-09-15T00:00:00.000Z", "amountPaid": 50000, "modeOfPayment": "UPI", "transactionId": "TXN123"} ],
      "feeId": "...", "academicYear": "2025-2026", "semester": "1"
    }
  ]
}</pre>
        <h3>Payments (Razorpay)</h3>
        <table>
          <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
          <tr><td class="post">POST</td><td><code>/api/payments/razorpay/order</code></td><td>Create Razorpay order (stores PaymentOrder)</td></tr>
          <tr><td class="post">POST</td><td><code>/api/payments/razorpay/verify</code></td><td>Verify signature; updates PaymentOrder + Fee payment history</td></tr>
  </table>
  <h4>Create Order (request)</h4>
  <pre>{ "feeId": "<feeId>", "amount": 1000, "currency": "INR" }</pre>
  <h4>Create Order (response)</h4>
  <pre>{
  "success": true,
  "data": { "id": "order_ABC123", "amount": 1000, "currency": "INR", "status": "created" },
  "paymentOrderId": "<PaymentOrder._id>"
}</pre>
  <h4>Verify Signature (request)</h4>
  <pre>{
  "razorpay_order_id": "order_ABC123",
  "razorpay_payment_id": "pay_DEF456",
  "razorpay_signature": "<signature>",
  "feeId": "<feeId>"
}</pre>
  <p class="note">HDFC endpoints exist as placeholders (<code>/api/payments/hdfc/*</code>), while Razorpay is the active gateway flow.</p>
      </section>

      <section id="attendance">
        <h2>Attendance</h2>
        <table>
          <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
          <tr><td class="post">POST</td><td><code>/api/attendance/record</code></td><td>Record/update attendance (links timetable if matched)</td></tr>
          <tr><td class="get">GET</td><td><code>/api/attendance/student/:studentId/daily?date=YYYY-MM-DD</code></td><td>Student daily view</td></tr>
          <tr><td class="get">GET</td><td><code>/api/attendance/student/:studentId/summary?startDate&endDate</code></td><td>Student summary</td></tr>
          <tr><td class="get">GET</td><td><code>/api/attendance/admin/daily?date=YYYY-MM-DD</code></td><td>Admin daily report</td></tr>
          <tr><td class="get">GET</td><td><code>/api/attendance/admin/summary?startDate&endDate</code></td><td>Admin summary</td></tr>
          <tr><td class="get">GET</td><td><code>/api/attendance/admin/occupancy?date=YYYY-MM-DD</code></td><td>By class/room: capacity, present, late, absent, earlyLeave, total</td></tr>
          <tr><td class="get">GET</td><td><code>/api/attendance/stream</code></td><td>SSE stream for live alerts (no auth by default)</td></tr>
          <tr><td class="get">GET</td><td><code>/api/attendance/logs?studentId=&date=</code></td><td>Entry logs</td></tr>
          <tr><td class="post">POST</td><td><code>/api/attendance/correction</code></td><td>Submit correction request</td></tr>
          <tr><td class="post">POST</td><td><code>/api/attendance/:id/correction/review</code></td><td>Admin review correction</td></tr>
        </table>
        <h3>Exports</h3>
        <ul>
          <li class="get"><code>GET /api/attendance/admin/export?startDate&endDate</code> → CSV (includes TimetableId, Capacity + OCCUPANCY rows)</li>
          <li class="get"><code>GET /api/attendance/admin/export.pdf?date=YYYY-MM-DD</code> → PDF (columns include TimetableId, Capacity + Occupancy Summary page)</li>
        </ul>
        <h3>Record example</h3>
        <pre>{
  "studentId": "<studentObjectId>",
  "className": "Anatomy 101",
  "date": "2025-09-26",
  "classStartTime": "2025-09-26T08:00:00.000Z",
  "classEndTime": "2025-09-26T10:00:00.000Z",
  "timeIn": "2025-09-26T08:10:00.000Z",
  "timeOut": "2025-09-26T10:00:00.000Z",
  "status": "Present"
}</pre>
        <h3>curl</h3>
        <pre>curl -X POST http://localhost:5000/api/attendance/record \
  -H "Authorization: Bearer <TOKEN>" -H "Content-Type: application/json" \
  -d '{
    "studentId": "<studentObjectId>",
    "className": "Anatomy 101",
    "date": "2025-09-26",
    "classStartTime": "2025-09-26T08:00:00.000Z",
    "classEndTime": "2025-09-26T10:00:00.000Z",
    "timeIn": "2025-09-26T08:10:00.000Z",
    "timeOut": "2025-09-26T10:00:00.000Z",
    "status": "Present"
  }'</pre>
        <h3>Occupancy (response)</h3>
        <pre>{
  "success": true,
  "data": [
    { "className": "Anatomy 101", "room": "A-101", "capacity": 60, "present": 20, "late": 3, "absent": 5, "earlyLeave": 1, "total": 29 }
  ]
}</pre>
      </section>

      <section id="timetable">
        <h2>Timetable</h2>
        <table>
          <tr><th>Method</th><th>Endpoint</th><th>Description</th></tr>
          <tr><td class="post">POST</td><td><code>/api/timetable</code></td><td>Create timetable entry (class, room, program, year, dayOfWeek, start/end, capacity)</td></tr>
          <tr><td class="get">GET</td><td><code>/api/timetable?programName=&academicYear=</code></td><td>List timetables (filters)</td></tr>
          <tr><td class="get">GET</td><td><code>/api/timetable/student/:studentId</code></td><td>Classes for a student</td></tr>
          <tr><td class="put">PUT</td><td><code>/api/timetable/:id</code></td><td>Update timetable</td></tr>
          <tr><td class="del">DELETE</td><td><code>/api/timetable/:id</code></td><td>Remove timetable</td></tr>
  </table>
  <h3>Create example</h3>
  <pre>{
  "className": "Anatomy 101",
  "room": "A-101",
  "programName": "MBBS",
  "academicYear": "2025-2026",
  "dayOfWeek": 5,
  "startTime": "08:00",
  "endTime": "10:00",
  "capacity": 60
}</pre>
      </section>

      <section id="reports">
        <h2>Exports & Reports</h2>
        <ul>
          <li>CSV Export: <code>/api/attendance/admin/export?startDate&endDate</code></li>
          <li>PDF Export (Daily): <code>/api/attendance/admin/export.pdf?date=YYYY-MM-DD</code></li>
          <li>Occupancy: <code>/api/attendance/admin/occupancy?date=YYYY-MM-DD</code></li>
        </ul>
        <p class="note">Attendance % is computed as (Present + Late) / Total.</p>
      </section>

      <section id="dashboard">
        <h2>Admin Dashboard</h2>
        <p>Live daily summary with auto-refresh on SSE alerts and periodic polling.</p>
        <ul>
          <li>URL: <code>/admin/dashboard?token=&lt;JWT&gt;</code></li>
          <li>Shows: Present, Late, Absent, Early Leave, Attendance %, and Occupancy table with capacity.</li>
          <li>Uses SSE at <code>/api/attendance/stream</code>.</li>
        </ul>
      </section>

      <section id="env">
        <h2>Environment & Notes</h2>
        <ul>
          <li>Base URL default: <code>http://localhost:5000</code></li>
          <li>JWT required for protected routes.</li>
          <li><code>ATTENDANCE_REQUIRE_TIMETABLE=true</code> will enforce timetable presence during record.</li>
          <li>SSE in production should be secured if needed.</li>
        </ul>
      </section>
    </main>
  </div>
</body>
</html>